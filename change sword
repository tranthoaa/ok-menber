local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local CommF = ReplicatedStorage.Remotes.CommF_

-- ===== CHECK ƒêANG C·∫¶M KI·∫æM =====
local function isEquipped(name)
    if not player.Character then return false end
    for _, v in pairs(player.Character:GetChildren()) do
        if v:IsA("Tool") and v.Name:lower():find(name:lower()) then
            return true
        end
    end
    return false
end

-- ===== UNEQUIP T·∫§T C·∫¢ =====
local function unequipAll()
    if not player.Character then return end
    for _, v in pairs(player.Character:GetChildren()) do
        if v:IsA("Tool") then
            v.Parent = player.Backpack
        end
    end
end

-- ===== EQUIP YAMA (FALLBACK) =====
local function equipYama()
    unequipAll()
    task.wait(0.2)

    -- c√°ch 1
    pcall(function()
        CommF:InvokeServer("EquipWeapon", "Yama")
    end)
    task.wait(0.4)
    if isEquipped("Yama") then return true end

    -- c√°ch 2
    pcall(function()
        CommF:InvokeServer("LoadItem", "Yama")
    end)
    task.wait(0.4)
    if isEquipped("Yama") then return true end

    -- c√°ch 3 (cu·ªëi)
    local backpack = player:WaitForChild("Backpack")
    for _, tool in pairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and tool.Name:lower():find("yama") then
            tool.Parent = player.Character
            task.wait(0.3)
            return isEquipped("Yama")
        end
    end

    return false
end

-- ===== CHECK INVENTORY =====
local tushitaMastery = 0
local hasTushita = false
local hasYama = false

for _, item in pairs(CommF:InvokeServer("getInventory")) do
    if item.Type == "Sword" then
        if item.Name:lower():find("tushita") then
            hasTushita = true
            tushitaMastery = item.Mastery or 0
        elseif item.Name:lower():find("yama") then
            hasYama = true
        end
    end
end

print("üìä Tushita mastery =", tushitaMastery)

-- ===== LOGIC CU·ªêI =====
if hasTushita and hasYama and tushitaMastery >= 350 then
    print("üî• ƒê·ªß ƒëi·ªÅu ki·ªán ‚Üí ƒëang equip Yama...")
    local ok = equipYama()
    print(ok and "‚úÖ ƒê√É EQUIP YAMA" or "‚ùå EQUIP YAMA TH·∫§T B·∫†I")
else
    print("‚è≥ Ch∆∞a ƒë·ªß ƒëi·ªÅu ki·ªán ho·∫∑c thi·∫øu ki·∫øm")
end


-- ===== V√íNG L·∫∂P HOP SERVER 30s =====
while true do
    local tushitaMastery = getMastery("Tushita")
    local yamaMastery = getMastery("Yama")

    print("üìä Tushita:", tushitaMastery, "| Yama:", yamaMastery)

    if tushitaMastery >= TARGET_MASTERY and yamaMastery >= TARGET_MASTERY then
        print("‚úÖ C·∫£ 2 mastery ‚â• 350 ‚Üí Hop server")
        task.wait(10) -- delay 10s tr∆∞·ªõc hop
        HopLowPlayer()
        break -- tho√°t v√≤ng l·∫∑p sau khi hop
    else
        print("‚è≥ Ch∆∞a ƒë·ªß mastery ‚Üí th·ª≠ l·∫°i sau 30 gi√¢y")
        task.wait(RETRY_TIME)
    end
end
