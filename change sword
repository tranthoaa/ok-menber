local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local CommF = ReplicatedStorage.Remotes.CommF_

-- ===== CHECK ƒêANG C·∫¶M KI·∫æM =====
local function isEquipped(name)
    if not player.Character then return false end
    for _, v in pairs(player.Character:GetChildren()) do
        if v:IsA("Tool") and v.Name:lower():find(name:lower()) then
            return true
        end
    end
    return false
end

-- ===== EQUIP KI·∫æM B·∫∞NG SERVER =====
local function equipSword(name)
    if isEquipped(name) then return true end
    pcall(function()
        CommF:InvokeServer("EquipWeapon", name)
    end)
    task.wait(0.3)
    return isEquipped(name)
end

-- ===== INVENTORY & MASTERY =====
local function getInventory()
    local inv = {}
    pcall(function()
        inv = CommF:InvokeServer("getInventory") or {}
    end)
    return inv
end

local function getMastery(name)
    for _, item in pairs(getInventory()) do
        if item.Type == "Sword" and item.Name:lower():find(name:lower()) then
            return tonumber(item.Mastery) or 0
        end
    end
    return 0
end

-- ===== AUTO FARM + HOP SERVER =====
local TARGET_MASTERY = 350

local function autoFarmHop()
    local hasTushita, hasYama = false, false

    -- check inventory
    for _, item in pairs(getInventory()) do
        if item.Type == "Sword" then
            if item.Name:lower():find("tushita") then hasTushita = true end
            if item.Name:lower():find("yama") then hasYama = true end
        end
    end

    if not hasTushita then warn("‚ùå Kh√¥ng c√≥ Tushita") return end
    if not hasYama then warn("‚ùå Kh√¥ng c√≥ Yama") return end

    -- ===== STEP 1: EQUIP TUSHITA =====
    if not isEquipped("Tushita") then
        print("‚öîÔ∏è Trang b·ªã Tushita...")
        equipSword("Tushita")
    end

    -- ===== STEP 2: FARM TUSHITA MASTERY =====
    while getMastery("Tushita") < TARGET_MASTERY do
        print("‚è≥ Ch·ªù Tushita ƒë·∫°t mastery 350:", getMastery("Tushita"))
        task.wait(3)
    end
    print("‚úÖ Tushita ƒë·∫°t mastery 350")

    -- ===== STEP 3: EQUIP YAMA =====
    if not isEquipped("Yama") then
        print("‚öîÔ∏è Trang b·ªã Yama...")
        equipSword("Yama")
    end

    -- ===== STEP 4: FARM YAMA MASTERY =====
    while getMastery("Yama") < TARGET_MASTERY do
        print("‚è≥ Ch·ªù Yama ƒë·∫°t mastery 350:", getMastery("Yama"))
        task.wait(3)
    end
    print("‚úÖ Yama ƒë·∫°t mastery 350")

    -- ===== STEP 5: HOP SERVER =====
    print("üåê ƒê·ªß ƒëi·ªÅu ki·ªán ‚Üí Hop server m·ªõi...")
    local placeId = game.PlaceId
    TeleportService:Teleport(placeId, player)
end

-- RUN AUTO
autoFarmHop()
